<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MCG G10 - 2024 3rd Term Test E-Report</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    /* Color Scheme */
    :root {
      --primary: #45a29e; /* Teal Green */
      --secondary: #6c757d; /* Grayish Blue */
      --accent: #f0ad4e; /* Orange */
      --success: #28a745; /* Green */
      --warning: #ffc107; /* Yellow */
      --info: #17a2b8; /* Cyan */
      --danger: #dc3545; /* Red */
      --white: #ffffff;
      --light-gray: #f8f9fa;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }
    body {
      background: linear-gradient(135deg, var(--light-gray), #e9ecef);
      color: var(--secondary);
      line-height: 1.6;
    }
    header {
      text-align: center;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: var(--white);
      padding: 2rem 0;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    header h1 {
      font-family: 'Montserrat', sans-serif;
      font-size: 2rem;
      color: var(--accent);
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }
    header p {
      font-size: 1rem;
      opacity: 0.9;
    }
    main {
      padding: 2rem 1rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    #search-section {
      text-align: center;
      margin-bottom: 2rem;
    }
    .search-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }
    #admission-number {
      padding: 0.8rem 1.2rem;
      font-size: 1rem;
      width: 100%;
      max-width: 300px;
      border: 2px solid var(--primary);
      border-radius: 25px;
      background: var(--white);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }
    #search-btn, #download-btn {
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: var(--white);
      border: none;
      border-radius: 25px;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    #report-section {
      display: none;
    }
    #chart-container {
      background: var(--white);
      padding: 1rem;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      margin: 1rem 0;
    }
    #student-info {
      background: var(--white);
      padding: 1rem;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }
    .info-card {
      text-align: center;
      padding: 1rem;
      border-radius: 10px;
      background: var(--light-gray);
      border: 2px solid var(--primary);
    }
    .info-card h3 {
      font-size: 1rem;
      color: var(--secondary);
      margin-bottom: 0.5rem;
    }
    .info-card p {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--primary);
    }
    .grade-distribution {
      background: var(--white);
      padding: 1rem;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      margin: 1rem 0;
    }
    .grade-distribution h3 {
      font-size: 1.2rem;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }
    .grade-distribution .badge {
      display: inline-block;
      padding: 0.5rem 1rem;
      margin-right: 0.5rem;
      border-radius: 20px;
      color: var(--white);
      font-weight: bold;
    }
    .grade-distribution .badge.success {
      background-color: var(--success);
    }
    .grade-distribution .badge.warning {
      background-color: var(--warning);
    }
    .grade-distribution .badge.info {
      background-color: var(--info);
    }
    .grade-distribution .badge.accent {
      background-color: var(--accent);
    }
    .grade-distribution .badge.danger {
      background-color: var(--danger);
    }
    .subject-details {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    .subject-details .badge {
      display: inline-block;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      color: var(--white);
      font-weight: bold;
    }
    footer {
      text-align: center;
      padding: 1rem;
      background: var(--white);
      color: var(--secondary);
      margin-top: 2rem;
      box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.1);
    }
    @media (min-width: 768px) {
      header h1 { font-size: 2.5rem; }
      #admission-number { font-size: 1.1rem; }
      #search-btn, #download-btn { font-size: 1.1rem; }
      .info-card { padding: 1.5rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1>MCG G10 - 2024 3rd Term Test E-Report</h1>
    <p>Class Teacher: Mrs. S.T. Indrani</p>
  </header>
  <main>
    <section id="search-section">
      <div class="search-container">
        <input type="text" id="admission-number" placeholder="Enter Admission Number...">
        <button id="search-btn">
          <i class="fas fa-chart-line"></i> Generate Report
        </button>
      </div>
    </section>
    <section id="report-section">
      <div id="chart-container">
        <canvas id="marks-chart"></canvas>
      </div>
      <div id="subject-marks-and-passes"></div>
      <div id="student-info">
        <div class="info-card">
          <h3><i class="fas fa-user-graduate"></i> Student Name</h3>
          <p id="student-name">-</p>
        </div>
        <div class="info-card">
          <h3><i class="fas fa-trophy"></i> Total Marks</h3>
          <p id="total-marks-display">-</p>
        </div>
        <div class="info-card">
          <h3><i class="fas fa-medal"></i> Current Rank</h3>
          <p id="place-rank">-</p>
        </div>
        <div class="info-card">
          <h3><i class="fas fa-percent"></i> Average Score</h3>
          <p id="average-marks">-</p>
        </div>
      </div>
      <div class="grade-distribution">
        <h3>Grade Distribution</h3>
        <div id="grade-distribution"></div>
      </div>
      <button id="download-btn"><i class="fas fa-download"></i> Download Report</button>
    </section>
  </main>
  <footer>
    <p>Designed By - Thisum Jalitha Â©</p>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const studentsData = {
      "6664": {
        name: "R.B. GUNASEKARA",
        place: 21,
        marks: [59, 70, 67, 73, 70, 63, 71, 58],
        subjects: ["Buddhism", "Sinhala", "Maths", "Science", "English", "History", "Commerce", "ICT"]
      },
      "6680": {
        name: "K.A.NAVINDU SIWHAS",
        place: 10,
        marks: [75, 85, 86, 73, 84, 73, 75, 75],
        subjects: ["Buddhism", "Sinhala", "Maths", "Science", "English", "History", "Geography", "ICT"]
      }
    };
    document.getElementById("search-btn").addEventListener("click", searchStudent);
    document.getElementById("admission-number").addEventListener("keypress", (e) => {
      if (e.key === "Enter") searchStudent();
    });
    document.getElementById("download-btn").addEventListener("click", downloadReport);

    function searchStudent() {
      const admissionNumber = document.getElementById("admission-number").value;
      const student = studentsData[admissionNumber];
      if (student) {
        const totalMarks = student.marks.reduce((a, b) => a + b, 0);
        const averageMarks = (totalMarks / student.marks.length).toFixed(2);
        document.getElementById("student-name").textContent = student.name;
        document.getElementById("total-marks-display").textContent = totalMarks;
        document.getElementById("place-rank").textContent = `#${student.place}`;
        document.getElementById("average-marks").textContent = `${averageMarks}%`;
        initChart(student);
        updateSubjectMarksAndPasses(student);
        updateGradeDistribution(student);
        document.getElementById("report-section").style.display = "block";
      } else {
        alert("Student not found! Please check admission number.");
      }
    }

    function initChart(student) {
      const ctx = document.getElementById('marks-chart').getContext('2d');
      const isMobile = window.innerWidth <= 768;
      if (window.myChart) window.myChart.destroy();
      window.myChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: student.subjects,
          datasets: [{
            data: student.marks,
            backgroundColor: student.marks.map(m => 
              m >= 75 ? '#28a745' : 
              m >= 60 ? '#ffc107' : 
              m >= 45 ? '#17a2b8' : 
              m >= 35 ? '#f0ad4e' : '#dc3545'
            ),
            borderColor: '#2c3e50',
            borderWidth: 2,
            borderRadius: 5
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              max: 100,
              grid: { color: '#dfe6e9' },
              ticks: { color: '#2c3e50', font: { size: isMobile ? 12 : 14 } }
            },
            x: {
              grid: { display: false },
              ticks: {
                color: '#2c3e50',
                font: { size: isMobile ? 10 : 12 },
                autoSkip: false,
                maxRotation: isMobile ? 90 : 0,
                minRotation: isMobile ? 90 : 0
              }
            }
          },
          plugins: {
            legend: { display: false },
            annotation: {
              annotations: {
                passLine: {
                  type: 'line',
                  yMin: 35,
                  yMax: 35,
                  borderColor: '#e74c3c',
                  borderWidth: 3,
                  borderDash: [5, 3],
                  label: {
                    content: 'Pass (35)',
                    display: true,
                    position: 'end',
                    backgroundColor: '#e74c3c',
                    color: 'white'
                  }
                },
                distinctionLine: {
                  type: 'line',
                  yMin: 75,
                  yMax: 75,
                  borderColor: '#FFD700',
                  borderWidth: 3,
                  borderDash: [5, 3],
                  label: {
                    content: 'Distinction (75)',
                    display: true,
                    position: 'end',
                    backgroundColor: '#FFD700',
                    color: '#2c3e50'
                  }
                }
              }
            }
          }
        }
      });
    }

    function updateSubjectMarksAndPasses(student) {
      const subjectMarksDiv = document.getElementById("subject-marks-and-passes");
      subjectMarksDiv.innerHTML = "";
      student.marks.forEach((mark, index) => {
        let badgeClass = '';
        let grade = '';
        if (mark >= 75) { badgeClass = 'success'; grade = 'A'; }
        else if (mark >= 60) { badgeClass = 'warning'; grade = 'B'; }
        else if (mark >= 45) { badgeClass = 'info'; grade = 'C'; }
        else if (mark >= 35) { badgeClass = 'accent'; grade = 'W'; }
        else { badgeClass = 'danger'; grade = 'S'; }
        const subjectBadge = document.createElement("span");
        subjectBadge.className = `badge ${badgeClass}`;
        subjectBadge.textContent = `${student.subjects[index]}: ${mark} (${grade})`;
        subjectMarksDiv.appendChild(subjectBadge);
      });
    }

    function updateGradeDistribution(student) {
      const gradeCounts = { A: 0, B: 0, C: 0, W: 0, S: 0 };
      student.marks.forEach(mark => {
        if (mark >= 75) gradeCounts.A++;
        else if (mark >= 60) gradeCounts.B++;
        else if (mark >= 45) gradeCounts.C++;
        else if (mark >= 35) gradeCounts.W++;
        else gradeCounts.S++;
      });
      const gradeDistributionDiv = document.getElementById("grade-distribution");
      gradeDistributionDiv.innerHTML = `
        ${gradeCounts.A > 0 ? `<span class="badge success">A: ${gradeCounts.A}</span>` : ''}
        ${gradeCounts.B > 0 ? `<span class="badge warning">B: ${gradeCounts.B}</span>` : ''}
        ${gradeCounts.C > 0 ? `<span class="badge info">C: ${gradeCounts.C}</span>` : ''}
        ${gradeCounts.W > 0 ? `<span class="badge accent">W: ${gradeCounts.W}</span>` : ''}
        ${gradeCounts.S > 0 ? `<span class="badge danger">S: ${gradeCounts.S}</span>` : ''}
      `;
    }

    function downloadReport() {
      html2canvas(document.querySelector("#report-section")).then(canvas => {
        const imgData = canvas.toDataURL('image/png');
        const pdf = new jsPDF('p', 'mm', 'a4');
        const imgProps = pdf.getImageProperties(imgData);
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
        pdf.save("report.pdf");
      });
    }
  </script>
</body>
</html>
